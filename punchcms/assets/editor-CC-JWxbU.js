import{e as r}from"./elRules-WV2ZY8TQ.js";import{t as b,e as q}from"./multiTag-OYfiRZEC.js";import{d as B,aj as E,b as f,G as I,n as j,c as H,e as d,o as g,I as M,j as l,g as s,ac as S,L as J,u as v,aA as L,N as z,l as A,f as F,aB as G,aI as $,J as w}from"./element-plus-C_WOaAPH.js";import"./index-DKy0qOiq.js";const K={class:"custom-dialog"},P={class:"header-title"},Q={class:"dialog-footer-right"},te=B({__name:"editor",props:{visible:{type:Boolean,default:!1},dialogType:{type:String,default:"add"},temp:{type:Object}},emits:["update:visible","submit"],setup(R,{emit:x}){const V=x,i=R,y=n=>n.setHours(0,0,0)<new Date().setHours(0,0,0)-1e3,k={id:0,title:"",content:"",start_time:+new Date().setHours(0,0,0),end_time:+new Date().setHours(23,59,59),sort:0,status:0},T=E([{label:"一般",value:0},{label:"置顶",value:1}]),e=f(null),m=f(),c=f(!1);I(async()=>{c.value=i.visible,i.dialogType==="edit"?e.value={id:i.temp.id,title:i.temp.title,content:i.temp.content,sort:i.temp.sort,status:i.temp.status,start_time:i.temp.start_time*1e3,end_time:i.temp.end_time*1e3}:e.value={...k},await j(),m.value.clearValidate()});const Y=H(()=>({title:[r().baseRequired],content:[r().baseRequired],start_time:[r().baseRequired],end_time:[r().baseRequired],status:[r().baseRequired],sort:[r().baseRequired]})),D=f(!1),C=()=>{D.value=!1,Object.keys(e.value).forEach(n=>{e.value[n]=k[n]})},_=()=>{c.value=!1,C(),V("update:visible",!1)},N=async()=>{m.value&&await m.value.validate(async n=>{if(!n)return;e.value.start_time=e.value.start_time/1e3,e.value.end_time=e.value.end_time/1e3;const t=JSON.parse(b.getItem("notice/list_notice")),u=t.result;if(i.dialogType==="add"){const o=u[u.length-1].id+1;u.push({content:e.value.content,create_time:Math.floor(e.value.start_time),end_time:Math.floor(e.value.end_time),id:o,sort:e.value.sort,start_time:Math.floor(e.value.start_time),status:e.value.status,title:e.value.title}),b.setItem("notice/list_notice",JSON.stringify(t))}else{const o=u.find(p=>i.temp.id===p.id);o&&(o.content=e.value.content,o.start_time=Math.floor(e.value.start_time),o.end_time=Math.floor(e.value.end_time),o.sort=e.value.sort,o.status=e.value.status,o.title=e.value.title),b.setItem("notice/list_notice",JSON.stringify(t))}_(),V("submit"),q.success()})};return(n,t)=>{const u=d("el-form-item"),o=d("el-input"),p=d("el-date-picker"),h=d("el-button"),O=d("el-form"),U=d("el-dialog");return g(),M("div",K,[l(U,{"close-on-click-modal":!1,modelValue:c.value,"onUpdate:modelValue":t[6]||(t[6]=a=>c.value=a),width:"800px",onClose:_},{header:s(()=>[S("div",P,J(n.$props.dialogType==="add"?"新增":"修改")+"公告 ",1)]),default:s(()=>[l(O,{ref_key:"formRef",ref:m,model:e.value,rules:Y.value,"validate-on-rule-change":!1},{default:s(()=>[l(u,{label:"属性",class:"custom-form-item",prop:"sort"},{default:s(()=>[l(v(L),{modelValue:e.value.sort,"onUpdate:modelValue":t[0]||(t[0]=a=>e.value.sort=a),"popper-class":"custom-select"},{default:s(()=>[(g(!0),M(z,null,A(v(T),a=>(g(),F(v(G),{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"标题",class:"custom-form-item",prop:"title"},{default:s(()=>[l(o,{modelValue:e.value.title,"onUpdate:modelValue":t[1]||(t[1]=a=>e.value.title=a),placeholder:"請輸入"},null,8,["modelValue"])]),_:1}),l(u,{label:"内容",class:"custom-form-item",prop:"content"},{default:s(()=>[l(o,{modelValue:e.value.content,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.content=a),placeholder:"請輸入",type:"textarea",autosize:{minRows:10}},null,8,["modelValue"])]),_:1}),l(u,{label:"开始时间",prop:"startTime",class:"custom-form-item"},{default:s(()=>[l(p,{class:"custom-date-picker","popper-class":"custom-date-picker",modelValue:e.value.start_time,"onUpdate:modelValue":t[3]||(t[3]=a=>e.value.start_time=a),format:"YYYY/MM/DD",initSearch:!1,type:"date",disabledDate:y},null,8,["modelValue"])]),_:1}),l(u,{label:"结束时间",prop:"endTime",class:"custom-form-item"},{default:s(()=>[l(p,{class:"custom-date-picker","popper-class":"custom-date-picker",modelValue:e.value.end_time,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value.end_time=a),format:"YYYY/MM/DD",initSearch:!1,type:"date",disabledDate:y},null,8,["modelValue"])]),_:1}),l(u,{label:"状态",prop:"status",class:"custom-form-item"},{default:s(()=>[l(v($),{modelValue:e.value.status,"onUpdate:modelValue":t[5]||(t[5]=a=>e.value.status=a),width:50,"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用","inline-prompt":""},null,8,["modelValue"])]),_:1}),S("div",Q,[l(h,{class:"default_button",onClick:_},{default:s(()=>[w("取消")]),_:1}),l(h,{class:"confirm_button",onClick:N,loading:D.value},{default:s(()=>[w("確認")]),_:1},8,["loading"])])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});export{te as default};
