import{C as V,S as B,D as H}from"./Detail-CcHeadF8.js";import{b as M,h as U,e as w}from"./multiTag-ix6R9492.js";import{p as O,H as j,_ as z}from"./index-Dh2Helq-.js";import{d as E,b as v,e as b,az as J,o as x,I,j as d,g as l,ac as _,L as i,K,ad as R,f as q,J as T,u as A,ak as F,al as G}from"./element-plus-C_WOaAPH.js";const C=m=>(F("data-v-733f6a92"),m=m(),G(),m),P={class:"content"},Q={key:0,class:"text-blue-500"},W=C(()=>_("span",{class:"inline-block mx-5px"},"~",-1)),X=C(()=>_("span",null," 出差 ",-1)),Y={class:"flex flex-col"},Z={class:"w100"},$={class:"red-notice w100"},ee=E({__name:"businessTrip",setup(m){const S=M(),u=v([]),h=v(!1),y=v({detail:!1}),p=v({date:null,row:[]}),N=async e=>{var r;const{firstDay:s,lastDay:o}=j(new Date(e.begin_time*1e3));try{h.value=!0,u.value=[];const n=await U.post({url:"business_trip_log/get_business_trip_log",payload:{user_id:e.user_id,begin_date:s,end_date:o},mockUrl:"business_trip_log/get_business_trip_log"});if(n.code===0){let a=n.data;e.user_id&&(a=a.filter(t=>t.user_id===e.user_id)),a.length&&(u.value=((r=a==null?void 0:a.map)==null?void 0:r.call(a,c=>({...c,dateTime:[D(String(c.begin_date),"begin"),D(String(c.end_date),"end")]})))||[]),u.value.length&&u.value.sort((c,t)=>t.oper_time-c.oper_time)}else w.error(n.msg)}catch(n){w.error(n)}finally{h.value=!1}},L=({date:e,row:s})=>{s&&(y.value.detail=!0,p.value={date:e,row:s})},f=(e,s)=>{if(!e)return"--";e=String(e);const o=e.slice(0,4),r=e.slice(4,6),n=e.slice(6,8);return s==="ydm"?o+"/"+r+"/"+n:r+"/"+n},D=(e,s)=>{typeof e!="string"&&(e=String(e));const o=parseInt(e.slice(0,4)),r=parseInt(e.slice(4,6))-1,n=parseInt(e.slice(6,8)),a=new Date(o,r,n);return s==="begin"?a.setHours(0,0,0,0):a.setHours(23,59,59,999),Math.floor(a.getTime()/1e3)},k=e=>{var s;return(s=S.userList.find(o=>e===o.username))==null?void 0:s.nickname};return(e,s)=>{const o=b("el-table-column"),r=b("el-table"),n=b("el-col"),a=b("el-row"),c=J("loading");return x(),I("div",null,[d(B,{onSearch:N},{calendar:l(({date:t})=>[d(V,{date:t,"data-list":u.value,"is-range":!0,onChoseDate:L},{content:l(({details:g})=>[_("div",P,[g!=null&&g.length?(x(),I("p",Q,"出差 ("+i(g.length)+")",1)):K("",!0)])]),_:2},1032,["date","data-list"])]),statement:l(()=>[R((x(),q(r,{data:u.value,class:"custom-table"},{default:l(()=>[d(o,{label:"暱稱",align:"center"},{default:l(({row:t})=>[T(i(k(t.username)),1)]),_:1}),d(o,{label:"出差時間",align:"center"},{default:l(({row:t})=>[_("span",null,i(f(t.begin_date,"dm")),1),W,_("span",null,i(f(t.end_date,"dm")),1)]),_:1}),d(o,{label:"備註",align:"center",prop:"desc",showOverflowTooltip:!0})]),_:1},8,["data"])),[[c,h.value]])]),_:1}),d(H,{visible:y.value.detail,"onUpdate:visible":s[0]||(s[0]=t=>y.value.detail=t),date:p.value.date,data:p.value.row},{header:l(()=>[T(i(A(O)(p.value.date.date,"{m}/{d}"))+" ",1),X]),default:l(({row:t})=>[d(a,{class:"flex items-center"},{default:l(()=>[d(n,{span:24},{default:l(()=>[_("div",Y,[_("span",Z,"("+i(k(t.username))+") : "+i(f(t.begin_date,"dm"))+" ~ "+i(f(t.end_date,"dm")),1),_("div",$,i(t.desc),1)])]),_:2},1024)]),_:2},1024)]),_:1},8,["visible","date","data"])])}}}),oe=z(ee,[["__scopeId","data-v-733f6a92"]]);export{oe as default};
